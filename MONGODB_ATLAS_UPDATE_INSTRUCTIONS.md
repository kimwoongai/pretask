# 📋 MongoDB Atlas 직접 업데이트 가이드

## 🎯 목표
통합 규칙 기능을 완전히 제거하고, AI가 제안한 좋은 규칙들을 기본 규칙에 통합하여 개별 규칙 전용 시스템으로 전환

## 📝 업데이트 순서

### 1️⃣ 기본 규칙 완전 교체

**컬렉션**: `dsl_rules`  
**대상 문서**: `_id: "68a58cea3c9a110dddf6c28f"`

1. MongoDB Atlas 로그인
2. `legal_db` → `dsl_rules` 컬렉션 이동
3. 문서 ID `68a58cea3c9a110dddf6c28f` 찾기
4. **Edit Document** 클릭
5. **전체 내용을 `mongodb_complete_rules_data.json` 파일 내용으로 교체**
6. **Save** 클릭

### 2️⃣ 위험한 개별 규칙 제거

**컬렉션**: `dsl_rules_individual`

다음 패턴의 규칙들을 **모두 삭제**:
- `_id`에 `fact_retention` 포함된 규칙
- `_id`에 `consolidated_` 포함된 규칙  
- `pattern`이 `"당사자 정보, 사건 발생 경위..."` 같은 긴 치환 텍스트인 규칙

### 3️⃣ 서비스 재시작 (선택사항)

Render에서 서비스 재시작하거나 자동 재배포 대기

## ✅ 업데이트 결과 확인

### 📊 새로운 규칙 시스템 특징

- **총 규칙 수**: 31개 (기존 + 최신 AI 제안 규칙들)
- **우선순위 체계**:
  - 100: UI 요소 제거
  - 99-95: 법적 판단/섹션 제거  
  - 94-90: 절차적 설명 제거
  - 89-85: 중복 정보 제거
  - 84-77: 구조적 노이즈 제거

### 🆕 **최신 추가 규칙들**:
- **제1심 참조 정보 제거**: `【제1심.*?참조)`
- **당사자 표시 제거**: `【원고, 항소인 겸 피항소인】`
- **판례 인용 제거**: `판례 인용.*?본다|법조문.*?해석`
- **연관판결 제거**: `【연관판결】.*|【주문】.*|【이유】.*`
- **심사 청구 결과 제거**: `심사 청구.*?기각되었다|소송비용은.*?부담한다`
- **법원 사건번호 제거**: `서울고등법원,\d{4}누\d{5}`

### 🎯 예상 처리 결과

**이전 (문제 상황):**
```json
{
  "applied_rules": [],
  "processed_content": "원본과 동일하거나 텍스트 파괴"
}
```

**업데이트 후 (정상):**
```json
{
  "applied_rules": [
    "ui_elements_removal",
    "legal_judgment_removal", 
    "procedural_info_removal",
    "case_metadata_removal",
    "ai_legal_filtering_685020ef7bceb320096f63ad_31",
    "ai_noise_removal_684fbd637bceb320096ec1d2_36"
  ],
  "processed_content": "UI 요소, 법적 판단, 절차적 설명, 판례 인용, 법원 사건번호가 제거된 깔끔한 사실관계"
}
```

## ⚠️ 주의사항

1. **백업 필수**: 업데이트 전 현재 데이터 백업
2. **단계별 진행**: 기본 규칙 교체 → 위험 규칙 제거 순서로
3. **즉시 테스트**: 업데이트 후 단건 처리로 결과 확인
4. **문제시 롤백**: 결과가 이상하면 백업으로 즉시 복원

## 🚀 성공 지표

- ✅ `applied_rules` 배열에 규칙들이 표시됨
- ✅ UI 요소 ("저장 인쇄 보관...") 제거됨
- ✅ 법적 판단 ("따라서 판단한다...") 제거됨  
- ✅ 토큰 수가 적절히 감소 (20-40% 정도)
- ✅ 핵심 사실관계는 보존됨
