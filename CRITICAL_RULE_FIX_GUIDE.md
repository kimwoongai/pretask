# 🚨 긴급 규칙 수정 완료 - 보수적 접근법

## 📋 **문제 상황 분석**
- **기존**: 31개 규칙, 97.5% 토큰 삭제 (830개 → 21개)
- **원인**: 중복 규칙들이 서로 경쟁하며 과도하게 제거
- **결과**: 핵심 사실관계까지 손실

## ✅ **해결책: 보수적 규칙 시스템**

### 🎯 **새로운 규칙 철학**
1. **확실한 노이즈만** 제거
2. **사실관계는 절대** 건드리지 않음
3. **단순하고 명확한** 패턴만 사용
4. **중복 규칙 완전** 제거

### 📊 **규칙 수 대폭 축소**
- **기존**: 31개 규칙 (너무 많음)
- **신규**: **11개 규칙** (핵심만 선별)
- **축소율**: 65% 감소

### 🔧 **새로운 규칙 구성**

#### **100-95 우선순위: 확실한 노이즈**
1. **UI 요소**: `판례상세 저장 인쇄 보관...`
2. **시스템 정보**: `국세법령정보시스템`, `판례ID:`

#### **95-85 우선순위: 메타데이터**
3. **재판 메타데이터**: `재판경과`, `참조판례 X 건`
4. **유사문서 섹션**: `유사문서 X 건...유사율`

#### **85-65 우선순위: 구조적 요소**
5. **판례 번호**: `^판례 \d+$` (라인 시작만)
6. **공식 섹션**: `^주 문$`, `^청 구 취 지$`
7. **소송비용**: `소송비용은...부담한다`
8. **사건번호**: `서울XX법원-2024-XX-12345 2024.01.01`

#### **70-50 우선순위: 선별적 제거**
9. **최종 결론**: 구체적 문구만 (`그렇다면 이 사건 소는...`)
10. **판례 인용**: 괄호 안만 (`(대법원...참조)`)
11. **포맷팅**: 페이지 번호, 구분선

### 🚫 **제거된 위험한 규칙들**

❌ **법적 판단 광범위 제거**: `따라서.*?판단한다`  
❌ **법리 해석 전체**: `법리상.*?해석`  
❌ **섹션 전체 삭제**: `【판결요지】.*?【판례내용】`  
❌ **절차 설명 전체**: `변론.*?진행`  

## 📈 **예상 개선 결과**

### **토큰 보존 목표**
- **기존**: 830개 → 21개 (3% 보존)
- **목표**: 830개 → **500-600개 (60-70% 보존)**

### **처리 결과 예시**

**입력:**
```
판례상세 저장 인쇄 보관 전자팩스 공유
재판경과 서울행정법원-2022-구합-88958 2023.08.17.
참조판례 0 건 인용판례 0 건
주 문
1. 이 사건 소를 각하한다.
이 유
1. 처분의 경위
가. 주식회사 ○○○은 2016년 개업하여 영화 제작업을 영위하였다.
나. 피고는 소외 법인이 부가가치세를 환급받았다고 보고 처분하였다.
그렇다면 이 사건 소는 부적법하므로 이를 각하하기로 하여 주문과 같이 판결한다
소송비용은 원고가 부담한다.
```

**예상 출력:**
```
1. 이 사건 소를 각하한다.
1. 처분의 경위
가. 주식회사 ○○○은 2016년 개업하여 영화 제작업을 영위하였다.
나. 피고는 소외 법인이 부가가치세를 환급받았다고 보고 처분하였다.
```

## 🚀 **즉시 적용 방법**

### **MongoDB Atlas 업데이트:**
1. `dsl_rules` 컬렉션 접근
2. 문서 `68a58cea3c9a110dddf6c28f` 편집
3. **전체 내용을 수정된 `mongodb_complete_rules_data.json`으로 교체**
4. 저장

### **즉시 테스트:**
- 같은 문서로 단건 처리 실행
- 토큰 수 확인: **500-600개 범위** 예상
- 사실관계 보존 확인

## ⚡ **핵심 개선사항**

✅ **규칙 수 65% 감소** (31개 → 11개)  
✅ **중복 제거 완료** (같은 패턴 여러 규칙 통합)  
✅ **보수적 접근** (확실한 것만 제거)  
✅ **사실관계 보호** (핵심 내용 절대 건드리지 않음)  
✅ **명확한 우선순위** (100-50 단순화)  

이제 과도한 삭제 문제가 완전히 해결될 것입니다! 🎉
