# 🚨 긴급 규칙 수정 가이드

## 📋 **문제 상황**
- **토큰 과도 삭제**: 830개 → 21개 (97.5% 삭제)
- **핵심 내용 손실**: 사실관계와 판결 요지가 거의 모두 제거됨
- **품질 저하**: FPR 0.65, 에러 발생

## 🔧 **긴급 수정 사항**

### 1️⃣ **기존 문제 규칙들**
다음 규칙들이 너무 공격적으로 작동하고 있음:

❌ **제거할 위험한 규칙들:**
- `legal_sections_removal` - 【판결요지】.*?【판례내용】 (너무 광범위)
- `legal_judgment_removal` - 따라서.*?판단한다 (사실관계도 제거)
- `legal_reasoning_removal` - 법리상.*?해석 (중요 내용 포함)
- `procedural_info_removal` - 변론.*?진행 (과도한 매칭)

### 2️⃣ **새로운 보수적 규칙 시스템**

**`mongodb_fixed_rules_data.json` 특징:**
- **총 12개 규칙** (기존 31개 → 12개로 축소)
- **보수적 접근**: 확실한 노이즈만 제거
- **사실관계 보존**: 핵심 내용은 절대 건드리지 않음
- **단계적 우선순위**: 100-50 범위로 조정

### 3️⃣ **우선순위 재설계**

```
100-95: UI 요소만 (판례상세, 저장, 인쇄 등)
90-85: 메타데이터 (재판경과, 참조판례 건수)
80-75: 공식 섹션 (주문, 청구취지)
70-65: 부수적 정보 (소송비용, 사건번호)
60-50: 포맷팅 (페이지 번호, 공백)
```

## 🚀 **즉시 적용 방법**

### **MongoDB Atlas 업데이트:**
1. `dsl_rules` 컬렉션 접근
2. 문서 `68a58cea3c9a110dddf6c28f` 편집
3. **전체 내용을 `mongodb_fixed_rules_data.json`으로 교체**
4. 저장

### **예상 개선 결과:**
- **토큰 보존율**: 60-70% (기존 3% → 개선)
- **사실관계 보존**: 핵심 내용 100% 유지
- **노이즈 제거**: UI, 메타데이터만 선별적 제거
- **품질 점수**: 0.7 → 0.85+ 예상

## 🧪 **테스트 케이스**

### **입력 예시:**
```
판례상세 저장 인쇄 보관
재판경과 서울행정법원-2022-구합-88958 2023.08.17.
참조판례 0 건 인용판례 0 건
주 문
1. 이 사건 소를 각하한다.
이 유
1. 처분의 경위
가. 주식회사 ○○○은 20**년 개업하여 영화 제작업을 영위하였다.
나. 피고는 소외 법인이 부가가치세를 환급받았다고 보고 처분하였다.
소송비용은 원고가 부담한다.
```

### **예상 출력:**
```
1. 이 사건 소를 각하한다.
1. 처분의 경위
가. 주식회사 ○○○은 20**년 개업하여 영화 제작업을 영위하였다.
나. 피고는 소외 법인이 부가가치세를 환급받았다고 보고 처분하였다.
```

## ⚠️ **주의사항**

1. **백업 필수**: 현재 규칙을 백업 후 교체
2. **즉시 테스트**: 교체 후 바로 단건 처리로 확인
3. **점진적 조정**: 결과 보고 필요시 추가 미세 조정
4. **모니터링**: FPR, NRR, Quality Score 지속 관찰

## 📈 **성공 지표**

✅ **토큰 보존율**: 60% 이상  
✅ **사실관계 보존**: 핵심 내용 유지  
✅ **UI 노이즈 제거**: 시스템 메뉴 완전 제거  
✅ **품질 점수**: 0.85 이상  
✅ **에러 없음**: 처리 과정에서 오류 발생 안함  

이 수정된 규칙으로 교체하면 과도한 삭제 문제가 해결될 것입니다!
